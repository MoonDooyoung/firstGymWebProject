<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="kr.co.firstgym.order.mapper.IOrderMapper">
  
  	<select id="getList" resultType="kr.co.firstgym.command.OrderProductVO">
  		select * from
	  		(
	  		select rownum as rn, tbl.* from
		  		(
		  		select *
  				from order_product op left outer join orders o
  				on op.o_num = o.o_num
  				where o.o_sendId = #{id}
  				order by o.o_num
		  		) tbl
		  	)
		<![CDATA[
		WHERE rn > (#{page.pageNum} - 1) * #{page.countPerPage}
		AND rn <= #{page.pageNum} * #{page.countPerPage}
		]]>
  	</select>
  	
  	<select id="getTotal" resultType="int">
  		select count(*)
  		from order_product op left outer join orders o
  		on op.o_num = o.o_num
  		where o.o_sendId = #{id}
  	</select>
  	
  	<select id="getContent" resultType="kr.co.firstgym.command.OrdersVO">
  		select *
  		from orders o left outer join order_product op
  		on op.o_num = o.o_num
  		where o.o_num = #{o_num}
  	</select>
  	
  	<select id="getProduct" resultType="kr.co.firstgym.command.ProductVO">
  		select *
  		from product
  		where p_num = #{p_num}
  	</select>
  	
  	<insert id="regist">
  		insert into orders
  		values(orders_seq.nextval, #{o_sendId}, #{o_sendName}, #{o_pNum}, #{o_method},
  		#{o_receiveName}, #{o_zipcode}, #{o_address}, #{o_detailAddress}, #{o_message},
  		sysdate, #{o_totalPrice}, #{o_email})
  	</insert>
  	
  	<insert id="registOP">
  		insert into order_product
  		values(order_product_seq.nextval, #{seq}, #{name}, #{price},
  		#{date}, #{category}, #{p_num})
  	</insert>
  	
  	<select id="selectSeq" resultType="int">
  		select orders_seq.currval from dual
  	</select>
  	
  	<select id="selectName" resultType="String">
  		select p_name from product where p_num=#{p_num}
  	</select>
  	
  	<select id="selectPrice" resultType="int">
  		select o_totalPrice from orders where o_num=#{seq}
  	</select>
  	
  	<select id="selectDate" resultType="String">
  		select o_date from orders where o_num=#{seq}
  	</select>
  	
  	<select id="selectCategory" resultType="String">
  		select p_category from product where p_num=#{p_num}
  	</select>
  
</mapper>